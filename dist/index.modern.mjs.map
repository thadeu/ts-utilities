{"version":3,"file":"index.modern.mjs","sources":["../src/Exception.ts","../src/Util.ts","../src/index.ts"],"sourcesContent":["export class TryException extends Error {\n  statusCode: number\n\n  constructor(message: string, statusCode?: number) {\n    super(message)\n\n    this.name = 'TryException'\n    this.statusCode = statusCode || 400\n\n    Error.captureStackTrace(this, this.constructor)\n  }\n}\n","export const isFunction = fn => fn?.constructor?.name === 'Function'\nexport const isAsyncFunction = fn => fn?.constructor?.name === 'AsyncFunction'\n\nexport const execute = (o, params = null) => {\n  if (isAsyncFunction(o)) {\n    return o(params)\n  }\n\n  if (isFunction(o)) {\n    return o(params)\n  }\n\n  return (() => o)()\n}\n\nexport const delay = ms => new Promise((resolve, reject) => setTimeout(resolve, ms))\n\nexport const race = (milliseconds, ...promises) => {\n  const timeout = new Promise((resolve, reject) => {\n    setTimeout(() => reject(`limit time excedded (${milliseconds} ms)`), milliseconds)\n  })\n\n  return Promise.race([timeout, ...promises])\n}\n","import { TryException } from '@/Exception'\nimport { execute, delay, race, isFunction, isAsyncFunction } from '@/Util'\n\nexport { delay, race, isAsyncFunction, isFunction }\n\ninterface TryOptions {\n  max?: number\n  exponential?: number\n  count?: number\n  strict?: boolean\n  timeout?: number\n  onError?: any\n  onRetry?: (count: number, isReached: boolean) => void\n}\n\nexport function Try(callable: any, options?: TryOptions) {\n  const max = options?.max ?? 0\n  let count = options?.count ?? 0\n\n  try {\n    if (isAsyncFunction(callable)) {\n      return race(options?.timeout ?? 9_999, execute(callable)).catch(e => {\n        if (count >= max) {\n          return execute(options?.onError, e)\n        }\n\n        count++\n\n        if (options?.onRetry) options.onRetry(count, count >= max)\n\n        return Try(callable, { ...options, count })\n      })\n    }\n\n    if (isFunction(callable)) {\n      return execute(callable)\n    }\n\n    return execute(callable)\n  } catch (error) {\n    if (count >= max) {\n      if (options?.strict) {\n        throw new TryException(error)\n      } else {\n        return execute(options?.onError, error)\n      }\n    }\n\n    count++\n\n    if (options?.onRetry) options.onRetry(count, count >= max)\n\n    if (max > 0) {\n      return (async function () {\n        await delay((count ** options?.exponential ?? 1.5) * 1_000)\n        return Try(callable, { ...options, count })\n      })()\n    }\n\n    return Try(callable, { ...options, count })\n  }\n}\n"],"names":["TryException","Error","constructor","message","statusCode","super","this","name","captureStackTrace","isFunction","fn","_fn$constructor","isAsyncFunction","_fn$constructor2","execute","o","params","delay","ms","Promise","resolve","reject","setTimeout","race","milliseconds","promises","timeout","Try","callable","options","_options$max","_options$count","max","count","_options$timeout","catch","e","onError","onRetry","_extends","error","strict","_ref","exponential"],"mappings":"oOAAM,MAAOA,UAAqBC,MAGhCC,YAAYC,EAAiBC,GAC3BC,MAAMF,GAAQG,KAHhBF,gBAKE,EAAAE,KAAKC,KAAO,eACZD,KAAKF,WAAaA,GAAc,IAEhCH,MAAMO,kBAAkBF,KAAMA,KAAKJ,YACrC,ECVW,MAAAO,EAAaC,IAAE,IAAAC,EAAI,MAA0B,cAAxB,MAAFD,GAAe,OAAbC,EAAFD,EAAIR,kBAAF,EAAFS,EAAiBJ,KAAS,EAC7CK,EAAkBF,IAAEG,IAAAA,EAAI,MAA0B,mBAAxBA,MAAFH,GAAAG,OAAEA,EAAFH,EAAIR,kBAAFW,EAAFA,EAAiBN,KAAS,EAElDO,EAAUA,CAACC,EAAGC,EAAS,OAC9BJ,EAAgBG,IAIhBN,EAAWM,GAHNA,EAAEC,GAOGD,EAGHE,EAAQC,GAAM,IAAIC,QAAQ,CAACC,EAASC,IAAWC,WAAWF,EAASF,IAEnEK,EAAOA,CAACC,KAAiBC,KACpC,MAAMC,EAAU,IAAIP,QAAQ,CAACC,EAASC,KACpCC,WAAW,IAAMD,EAA+B,wBAAAG,SAAqBA,EACvE,GAEA,OAAOL,QAAQI,KAAK,CAACG,KAAYD,GAAS,ECP5B,SAAAE,EAAIC,EAAeC,GAAoBC,IAAAA,EAAAC,EACrD,MAAMC,EAAkB,OAAfF,EAAGD,MAAAA,OAAAA,EAAAA,EAASG,KAAGF,EAAI,EAC5B,IAAIG,EAAsBF,OAAjBA,EAAU,MAAPF,OAAO,EAAPA,EAASI,OAAKF,EAAI,EAE9B,IACiC,IAAAG,EAA/B,OAAItB,EAAgBgB,GACXL,EAAqBW,OAAjBA,EAAQ,MAAPL,OAAO,EAAPA,EAASH,SAAOQ,EAAI,KAAOpB,EAAQc,IAAWO,MAAMC,GAC1DH,GAASD,EACJlB,EAAQe,MAAAA,OAAAA,EAAAA,EAASQ,QAASD,IAGnCH,IAEIJ,MAAAA,GAAAA,EAASS,SAAST,EAAQS,QAAQL,EAAOA,GAASD,GAE/CL,EAAIC,EAAQW,EAAA,CAAA,EAAOV,EAAO,CAAEI,cAInCxB,EAAWmB,GACNd,EAAQc,GAIlB,CAAC,MAAOY,GACP,GAAIP,GAASD,EAAK,CAChB,GAAW,MAAPH,GAAAA,EAASY,OACX,MAAM,IAAIzC,EAAawC,GAEvB,OAAO1B,EAAQe,MAAAA,OAAAA,EAAAA,EAASQ,QAASG,EAEpC,CAMD,OAJAP,IAEW,MAAPJ,GAAAA,EAASS,SAAST,EAAQS,QAAQL,EAAOA,GAASD,GAElDA,EAAM,iBACAU,GAEN,aADMzB,EAA+C,KAAXyB,OAA9BA,EAACT,IAAgB,MAAPJ,OAAO,EAAPA,EAASc,cAAWD,EAAI,MACvCf,EAAIC,EAAQW,EAAOV,CAAAA,EAAAA,GAASI,UACrC,IAGKN,EAAIC,EAAQW,KAAOV,EAAO,CAAEI,UACpC,CACH"}